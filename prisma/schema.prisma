generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model House {
  id        String   @id @default(cuid())
  name      String   @default("My Kitchen")
  createdAt DateTime @default(now())
  
  users           User[]
  members         HouseholdMember[]
  pantryItems     PantryItem[]
  recipes         Recipe[]
  tagSuggestions  TagSuggestion[]
}

model User {
  id        String   @id @default(cuid())
  email     String   @unique
  password  String
  name      String
  surname   String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  
  houseId         String
  house           House            @relation(fields: [houseId], references: [id], onDelete: Cascade)
  householdMember HouseholdMember?
}

model HouseholdMember {
  id           String        @id @default(cuid())
  name         String
  restrictions Restriction[]
  likes        Like[]
  dislikes     Dislike[]
  isGuest      Boolean       @default(false)
  
  houseId      String
  house        House    @relation(fields: [houseId], references: [id], onDelete: Cascade)
  
  userId       String?  @unique
  user         User?    @relation(fields: [userId], references: [id])
}

model Restriction {
  id       String          @id @default(cuid())
  name     String
  members  HouseholdMember[]
}

model Like {
  id       String          @id @default(cuid())
  name     String
  members  HouseholdMember[]
}

model Dislike {
  id       String          @id @default(cuid())
  name     String
  members  HouseholdMember[]
}

model PantryItem {
  id      String   @id @default(cuid())
  name    String
  recipes Recipe[]
  
  houseId String
  house   House  @relation(fields: [houseId], references: [id], onDelete: Cascade)
  
  inStock Boolean @default(true)

  @@unique([name, houseId])
}

model Recipe {
  id                      String       @id @default(cuid())
  createdAt               DateTime     @default(now())
  recipe_title            String
  analysis_log            String       @db.Text
  match_reasoning         String       @db.Text
  ingredients_from_pantry Json         // Storing list for display, but also linking to PantryItem
  shopping_list           Json
  step_by_step            Json
  safety_badge            Boolean
  meal_type               String
  difficulty              String
  prep_time               String
  dishImage               String?      @db.Text
  isFavorite              Boolean      @default(false)
  language                String       @default("en")
  pantryItems             PantryItem[]
  
  houseId                 String
  house                   House        @relation(fields: [houseId], references: [id], onDelete: Cascade)
}

model TagSuggestion {
  id       String @id @default(cuid())
  category String
  tag      String

  houseId  String
  house    House  @relation(fields: [houseId], references: [id], onDelete: Cascade)

  @@unique([category, tag, houseId])
}
